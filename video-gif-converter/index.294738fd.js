var e,t={};self,t=(()=>{let e;var t,i,r,o={m:{},d:(e,t)=>{for(var i in t)o.o(t,i)&&!o.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},u:e=>e+".ffmpeg.js"};o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{o.g.importScripts&&(e=o.g.location+"");var e,t=o.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");if(i.length)for(var r=i.length-1;r>-1&&!e;)e=i[r--].src}if(!e)throw Error("Automatic publicPath is not supported in this browser");o.p=e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/")})(),o.b=document.baseURI||self.location.href;var a,n={};o.r(n),o.d(n,{FFFSType:()=>r,FFmpeg:()=>c}),(t=a||(a={})).LOAD="LOAD",t.EXEC="EXEC",t.FFPROBE="FFPROBE",t.WRITE_FILE="WRITE_FILE",t.READ_FILE="READ_FILE",t.DELETE_FILE="DELETE_FILE",t.RENAME="RENAME",t.CREATE_DIR="CREATE_DIR",t.LIST_DIR="LIST_DIR",t.DELETE_DIR="DELETE_DIR",t.ERROR="ERROR",t.DOWNLOAD="DOWNLOAD",t.PROGRESS="PROGRESS",t.LOG="LOG",t.MOUNT="MOUNT",t.UNMOUNT="UNMOUNT";let s=(e=0,()=>e++),d=(Error("unknown message type"),Error("ffmpeg is not loaded, call `await ffmpeg.load()` first")),l=Error("called FFmpeg.terminate()");Error("failed to import ffmpeg-core.js");class c{#e=null;#t={};#i={};#r=[];#o=[];loaded=!1;#a=()=>{this.#e&&(this.#e.onmessage=({data:{id:e,type:t,data:i}})=>{switch(t){case a.LOAD:this.loaded=!0,this.#t[e](i);break;case a.MOUNT:case a.UNMOUNT:case a.EXEC:case a.FFPROBE:case a.WRITE_FILE:case a.READ_FILE:case a.DELETE_FILE:case a.RENAME:case a.CREATE_DIR:case a.LIST_DIR:case a.DELETE_DIR:this.#t[e](i);break;case a.LOG:this.#r.forEach(e=>e(i));break;case a.PROGRESS:this.#o.forEach(e=>e(i));break;case a.ERROR:this.#i[e](i)}delete this.#t[e],delete this.#i[e]})};#n=({type:e,data:t},i=[],r)=>this.#e?new Promise((o,a)=>{let n=s();this.#e&&this.#e.postMessage({id:n,type:e,data:t},i),this.#t[n]=o,this.#i[n]=a,r?.addEventListener("abort",()=>{a(new DOMException(`Message # ${n} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(d);on(e,t){"log"===e?this.#r.push(t):"progress"===e&&this.#o.push(t)}off(e,t){"log"===e?this.#r=this.#r.filter(e=>e!==t):"progress"===e&&(this.#o=this.#o.filter(e=>e!==t))}load=({classWorkerURL:e,...t}={},{signal:i}={})=>(this.#e||(this.#e=e?new Worker(new URL(e,"file:///Users/focus/Projects/ffmpeg.wasm/packages/ffmpeg/dist/esm/classes.js"),{type:"module"}):new Worker(new URL(o.p+o.u(814),o.b),{type:void 0}),this.#a()),this.#n({type:a.LOAD,data:t},void 0,i));exec=(e,t=-1,{signal:i}={})=>this.#n({type:a.EXEC,data:{args:e,timeout:t}},void 0,i);ffprobe=(e,t=-1,{signal:i}={})=>this.#n({type:a.FFPROBE,data:{args:e,timeout:t}},void 0,i);terminate=()=>{for(let e of Object.keys(this.#i))this.#i[e](l),delete this.#i[e],delete this.#t[e];this.#e&&(this.#e.terminate(),this.#e=null,this.loaded=!1)};writeFile=(e,t,{signal:i}={})=>{let r=[];return t instanceof Uint8Array&&r.push(t.buffer),this.#n({type:a.WRITE_FILE,data:{path:e,data:t}},r,i)};mount=(e,t,i)=>this.#n({type:a.MOUNT,data:{fsType:e,options:t,mountPoint:i}},[]);unmount=e=>this.#n({type:a.UNMOUNT,data:{mountPoint:e}},[]);readFile=(e,t="binary",{signal:i}={})=>this.#n({type:a.READ_FILE,data:{path:e,encoding:t}},void 0,i);deleteFile=(e,{signal:t}={})=>this.#n({type:a.DELETE_FILE,data:{path:e}},void 0,t);rename=(e,t,{signal:i}={})=>this.#n({type:a.RENAME,data:{oldPath:e,newPath:t}},void 0,i);createDir=(e,{signal:t}={})=>this.#n({type:a.CREATE_DIR,data:{path:e}},void 0,t);listDir=(e,{signal:t}={})=>this.#n({type:a.LIST_DIR,data:{path:e}},void 0,t);deleteDir=(e,{signal:t}={})=>this.#n({type:a.DELETE_DIR,data:{path:e}},void 0,t)}return(i=r||(r={})).MEMFS="MEMFS",i.NODEFS="NODEFS",i.NODERAWFS="NODERAWFS",i.IDBFS="IDBFS",i.WORKERFS="WORKERFS",i.PROXYFS="PROXYFS",n})();var i={},r=i&&i.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(o,a){function n(e){try{d(r.next(e))}catch(e){a(e)}}function s(e){try{d(r.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?o(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(n,s)}d((r=r.apply(e,t||[])).next())})};Object.defineProperty(i,"__esModule",{value:!0}),i.toBlobURL=i.downloadWithProgress=i.importScript=i.fetchFile=void 0;var o={};Object.defineProperty(o,"__esModule",{value:!0}),o.ERROR_INCOMPLETED_DOWNLOAD=o.ERROR_RESPONSE_BODY_READER=void 0,o.ERROR_RESPONSE_BODY_READER=Error("failed to get response body reader"),o.ERROR_INCOMPLETED_DOWNLOAD=Error("failed to complete download");var a={};Object.defineProperty(a,"__esModule",{value:!0}),a.HeaderContentLength=void 0,a.HeaderContentLength="Content-Length";const n=e=>new Promise((t,i)=>{let r=new FileReader;r.onload=()=>{let{result:e}=r;e instanceof ArrayBuffer?t(new Uint8Array(e)):t(new Uint8Array)},r.onerror=e=>{var t,r;i(Error(`File could not be read! Code=${(null===(r=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.error)||void 0===r?void 0:r.code)||-1}`))},r.readAsArrayBuffer(e)});i.fetchFile=e=>r(void 0,void 0,void 0,function*(){let t;if("string"==typeof e)t=/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(e)?atob(e.split(",")[1]).split("").map(e=>e.charCodeAt(0)):yield(yield fetch(e)).arrayBuffer();else if(e instanceof URL)t=yield(yield fetch(e)).arrayBuffer();else{if(!(e instanceof File||e instanceof Blob))return new Uint8Array;t=yield n(e)}return new Uint8Array(t)}),i.importScript=e=>r(void 0,void 0,void 0,function*(){return new Promise(t=>{let i=document.createElement("script"),r=()=>{i.removeEventListener("load",r),t()};i.src=e,i.type="text/javascript",i.addEventListener("load",r),document.getElementsByTagName("head")[0].appendChild(i)})}),i.downloadWithProgress=(e,t)=>r(void 0,void 0,void 0,function*(){var i;let r;let n=yield fetch(e);try{let s=parseInt(n.headers.get(a.HeaderContentLength)||"-1"),d=null===(i=n.body)||void 0===i?void 0:i.getReader();if(!d)throw o.ERROR_RESPONSE_BODY_READER;let l=[],c=0;for(;;){let{done:i,value:r}=yield d.read(),a=r?r.length:0;if(i){if(-1!=s&&s!==c)throw o.ERROR_INCOMPLETED_DOWNLOAD;t&&t({url:e,total:s,received:c,delta:a,done:i});break}l.push(r),c+=a,t&&t({url:e,total:s,received:c,delta:a,done:i})}let E=new Uint8Array(c),u=0;for(let e of l)E.set(e,u),u+=e.length;r=E.buffer}catch(i){console.log("failed to send download progress event: ",i),r=yield n.arrayBuffer(),t&&t({url:e,total:r.byteLength,received:r.byteLength,delta:0,done:!0})}return r}),i.toBlobURL=(e,t,o=!1,a)=>r(void 0,void 0,void 0,function*(){let r=new Blob([o?yield(0,i.downloadWithProgress)(e,a):yield(yield fetch(e)).arrayBuffer()],{type:t});return URL.createObjectURL(r)}),(ffmpeg=new t.FFmpeg).on("progress",({progress:e,time:t})=>{document.getElementById("progress").textContent=`${(100*e).toFixed(2)} %, time: ${(t/1e6).toFixed(2)} s`});const s=async()=>{let e="https://unpkg.com/@ffmpeg/core/dist/umd";await ffmpeg.load({coreURL:await (0,i.toBlobURL)(`${e}/ffmpeg-core.js`,"text/javascript"),wasmURL:await (0,i.toBlobURL)(`${e}/ffmpeg-core.wasm`,"application/wasm")});let t=await document.getElementById("fileInput").files[0];if(!t)return;let{name:r}=t,o=document.getElementById("outputType").value;document.getElementById("output").firstChild.replaceWith(document.createElement("span")),await ffmpeg.writeFile(r,await (0,i.fetchFile)(t)),document.getElementById("progress").textContent="Transcoding started",console.log(`${new Date().toLocaleTimeString()} Transcoding started`),await ffmpeg.exec(["-i",r,`output.${o}`]),document.getElementById("progress").textContent="Transcoding ended",console.log(`${new Date().toLocaleTimeString()} Transcoding ended`);let a=await ffmpeg.readFile(`output.${o}`);if("gif"==o){let e=document.createElement("img");e.src=URL.createObjectURL(new Blob([a.buffer],{type:"image/gif"})),e.classList.add("outputImg"),document.getElementById("output").firstChild.replaceWith(e)}else{let e=document.createElement("source");e.src=URL.createObjectURL(new Blob([a.buffer],{type:`video/${o}`}));let t=document.createElement("video");t.setAttribute("controls",""),t.appendChild(e),t.classList.add("outputVideo"),document.getElementById("output").firstChild.replaceWith(t)}},d=()=>{let e=document.getElementById("fileInput").files[0];if(document.getElementById("output").firstChild.replaceWith(document.createElement("span")),"image/gif"==e.type){let t=document.createElement("img");t.src=URL.createObjectURL(e),t.classList.add("inputImg"),document.getElementById("originalFile").firstChild.replaceWith(t)}else{let t=document.createElement("source");t.src=URL.createObjectURL(e);let i=document.createElement("video");i.setAttribute("controls",""),i.appendChild(t),i.classList.add("inputVideo"),document.getElementById("originalFile").firstChild.replaceWith(i)}};document.addEventListener("DOMContentLoaded",async()=>{document.getElementById("startTranscode").addEventListener("click",s),document.getElementById("chooseFile").addEventListener("click",()=>{document.getElementById("fileInput").click()}),document.getElementById("fileInput").addEventListener("change",d)});
//# sourceMappingURL=index.294738fd.js.map
